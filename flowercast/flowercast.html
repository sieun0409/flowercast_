<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>flowercast</title>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment-with-locales.min.js" integrity="sha512-4F1cxYdMiAW98oomSLaygEwmCnIP38pb4Kx70yQYqRwLVCs3DbRumfBq82T08g/4LJ/smbFGFpmeFlQgoDccgg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>

        * {
            font-family: "Noto Sans", sans-serif;
            font-optical-sizing: auto;
            font-style: normal;
            font-weight: 500;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-user-drag: none;
        }

        .container {
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        #device {
            width: 402px;
            height: 874px;
            border: 8px solid #333;
            border-radius: 50px;
            overflow: hidden;
            position: relative;
            overflow-y: scroll;
            overflow-x: hidden;
            position: relative;
        }

        #device::-webkit-scrollbar {
            display: none;
        }

        #device {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .gradient-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom, 
                rgba(0, 0, 0, 0.0) 0%,
                rgba(0, 0, 0, 0.1) 10%,
                rgba(0, 0, 0, 0.2) 70%,
                rgba(0, 0, 0, 0.5) 100%
            );
            pointer-events: none;
            z-index: 1;
        }

        .n_weather {
            position: absolute;
            top: 80px;
            width: 100%;
            text-align: center;
            color: white;
            z-index: 2;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.4);
        }

        .hourweather_container {
            width: 90%; 
            position: absolute;
            top: 420px;
            z-index: 2;
            color: white;
            margin: 0 auto;
            left: 0;
            right: 0;

            background-color: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-radius: 15px;
            padding: 0;
            box-sizing: border-box;
            overflow: hidden;
        }

        .hourweather_container > p {
            text-align: left;
            margin: 0;
            padding: 5px 10px 0px 10px;
            font-weight: normal;
            font-size: 0.9em;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.4);
        }

        #forecast { 
            border-top: 1px solid rgba(255, 255, 255, 0.5); 
            display: flex;
            overflow-x: scroll; 
            padding: 15px; 
            gap: 10px; 
            flex-wrap: nowrap;

            border-top: 1px solid rgba(255, 255, 255, 0.5); 
            display: flex;
            overflow-x: scroll; 
            padding: 15px; 
            gap: 5px;
            flex-wrap: nowrap;
            cursor: default;
            user-select: none;
            scroll-snap-type: x mandatory;
            scroll-padding: 15px;
            scroll-behavior: smooth;
        }

        #forecast::-webkit-scrollbar {
            display: none;
        }

        #forecast > div {
            width: 70px; 
            scroll-snap-align: start;
            flex-shrink: 0;
        }

        #forecast > div h3 {
            font-size: 0.9em;
            font-weight: normal;
            margin: 0;
            line-height: 1;
        }

        #forecast > div img {
            width: 40px;
            height: 40px;
        }

        #forecast > div p {
            font-size: 1.1em;
            font-weight: bold;
            margin: 0;
            line-height: 1;
        }

        .flower {
            position: absolute;
            bottom: 120px;
            width: 100%;
            text-align: center;
            color: white; 
            z-index: 2;
        }

        .bar {
            position: absolute; 
            bottom: 30px;
            width: 150px;
            height: 5px;
            background-color: white;
            border-radius: 5px;
            z-index: 20;
            margin-left: auto;
            margin-right: auto;
            left: 0;
            right: 0;
            cursor: pointer; 
        }

        #forecast {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        #forecast > div {
            text-align: center;
        }

        .rain_container {
            width: 90%; 
            position: absolute;
            top: 600px;
            z-index: 2;
            color: white;
            margin: 0 auto;
            left: 0;
            right: 0;

            background-color: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-radius: 15px;
            padding: 0;
            box-sizing: border-box;
            overflow: hidden; 
        }

        .rain_container > p {
            text-align: left;
            margin: 0;
            padding: 8px 0px 10px 10px;
            font-weight: normal;
            font-size: 0.9em;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.4);
        }

        #rain_forecast { 
            border-top: 1px solid rgba(255, 255, 255, 0.5); 
    
            display: flex;
            overflow-x: scroll; 
    
            padding: 15px; 
    
            gap: 5px; 
            flex-wrap: nowrap;
    
            scroll-snap-type: x mandatory; 
            scroll-padding: 15px; 
            scroll-behavior: smooth;
    
            cursor: default; 
            user-select: none;
        }

        #rain_forecast::-webkit-scrollbar {
            display: none;
        }
        #rain_forecast {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        #rain_forecast > div {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            width: 70px;
            height: 120px;
    
            background-color: transparent; 
            border: 1px solid rgba(255, 255, 255, 0.5); 
            border-radius: 15px;
            padding: 10px 0;
            box-sizing: border-box;
            text-align: center;
            color: white;
            font-size: 0.9em;
    
            flex-shrink: 0; 
            scroll-snap-align: start; 
        }

        #rain_forecast > div h3 {
            font-size: 0.9em;
            font-weight: normal;
            margin: 0;
            line-height: 1;
        }

        #rain_forecast > div img {
            width: 40px; 
            height: 40px;
            opacity: 0.8;
        }

        #rain_forecast > div p {
            font-size: 1.0em;
            font-weight: bold;
            margin: 0;
            line-height: 1;
        }

        #dt, #tm {
            font-size: 15px;
        }

        #lc {
            font-size: 30px;
            margin-bottom: 0px;
            font-weight: 600;
        }

        .degree-symbol {
            font-size: 0.5em;
            vertical-align: top;
            margin-left: 2px;
            font-weight: 500;
            vertical-align: super;
        }

        #temp {
            font-size: 80px; 
            font-weight: 600;
            margin-top: -10px;
        }

        #we, #fl {
            font-size: 18px;
            margin: 5px 0;
        }

        #temp_minmax {
            font-size: 16px;
            margin-top: 10px;
        }

        #ment {
            margin-top: 20px;
        }

        #hidden_box {
            position: absolute;
            width: 100%;
            height: 600px;
            
            
            margin: 0 auto; 
            left: 0; 
            right: 0;

            padding: 20px;
            background-color: rgba(220, 220, 220, 0.589);
            backdrop-filter: blur(15px);
            border-radius: 50px 50px 0 0;
            color: #333;
            text-align: left;
            box-sizing: border-box;
            z-index: 10; 
            bottom: 0; 
            transform: translateY(555px); 
            transition: transform 0.5s ease-out;

            text-align: center;
        }

        #hidden_box * {
            opacity: 0;
            transition: opacity 0.3s ease-in 0.4s;
        }

 
        #hidden_box.show {
            transform: translateY(0);
        }

        #hidden_box.show * {
            opacity: 1;
        }

        #hidden_box h2 {
            font-size: 1.2em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        #hidden_box p {
            font-size: 0.9em;
            margin: 5px 0;
            font-weight: 400;
        }

        .hbic1 .material-symbols-outlined {
            font-size: 2em;
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            display: inline-block;
            margin-top: 10px;
        }

        .hbic2 .material-symbols-outlined {
            font-size: 1.8em;
            color: #333; 
        }

        .hbic2  {
            margin-top: -80px;
        }

        .box_title {
            margin-bottom: 20px;
        }

        .box_title p{
            font-size: 25px;
        }

        .box_con1 {
            text-align: justify; 
            margin-bottom: 40px;
        }

        .box_con2{
            font-weight: 700;
            font-size: 20px;
            margin-bottom: 30px;
        }

        .box_con4 {
            display: flex;
            align-items: center; 
            justify-content: space-around; 
            width: 100%; 
        }

        .box_con3 {
            margin-right: 15px;
        }

        .text-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
            flex-grow: 1; 
        }

        .text-info h2 {
            font-size: 1.0em;
            margin: 0; 
            line-height: 1.2;
            text-align: justify;
            font-weight: 600;
        }

        .text-info h3 {
            font-size: 0.8em;
            margin: 0; 
            line-height: 1.2;
            text-align: justify;
            font-weight: 400;
        }
    

    </style>
</head>
<body>
    <div class="container">
        <div id="device">
            <div class="gradient-overlay"></div><img class="bgim">
                <div class="n_weather">
                    <p id="dt"></p>
                    <p id="tm"></p>
                    <p id="lc"></p>
                    <p id="temp"></p>
                    <p id="we"></p>
                    <p id="fl"></p>
                    <p id="temp_minmax"></p>
                    <h3 id="ment"></h3>
                </div>

                <div class="hourweather_container">
                    <p>시간대별 날씨를 알려드려요</p>
                    <div id="forecast"></div>
                </div>

                <div class="rain_container">
                    <p>시간대별 강수량 확률을 알려드려요</p>
                    <div id="rain_forecast"></div>
                </div>

            <div class="bar"></div>
                <div id="hidden_box">
                    <div class="hbic1">
                        <span class="material-symbols-outlined">menstrual_health</span>
                    </div>

                    <div class="box_title">
                        <p>오늘의 꽃은, <h2>동백꽃</h2></p>
                    </div>

                    <div class="box_con1">
                        <p>좁은 의미에서는 한국에서 자생하는 동백나무(Camellia japonica)의 붉은 꽃을 말하는 것이지만, 넓은 의미로 쓰일 때는 차나무과 동백나무속에 속하는 여러 종의 꽃들을 총칭하는 말이다. 영어권에서는 '카멜리아(Camellia)'라고 부른다.대략 11월 말부터 꽃을 피우기 시작해서 2~3월에 만발하는 편이다.</p>
                    </div>

                    <div class="box_con2">최적의 장소를 찾아드릴게요
                    </div>

                    <div class="box_con4">

                        <div class="box_con3">
                            <img src="images/flower.jpg" width="110" height="110">
                        </div>

                        <div class="hbic2">
                            <span class="material-symbols-outlined">distance</span>
                        </div>
                        <div class="text-info"> 
                            <h2>동백포레스트</h2>
                            <h3>11월에 꽃을 피워 2월까지 분홍빛 동백으로 만발합니다. 동백포레스트를 가득채운 동백나무는 가장 아름다운 분홍빛으로 아름다운 겨울제주의 정취를 선사합니다.</h3>
                        </div>

                    </div>
                </div>
        </div>
    </div>
</body>
    

<script>
    let url = 'https://api.openweathermap.org/data/2.5/weather?lat=60.1087&lon=-113.6426&appid=64c0242b8ce666f384557c8611204d9a&units=metric&lang=kr'


    function mapIcon(iconCode) {
        if (iconCode == "01d" || iconCode == "01n") {
            return "SUNNY"
        } else if (
            iconCode == "09d" || iconCode == "09n" ||
            iconCode == "10d" || iconCode == "10n" ||
            iconCode == "11d" || iconCode == "11n"
        ) {
            return "RAINY"
        } else if (
            iconCode == "02d" || iconCode == "02n" ||
            iconCode == "03d" || iconCode == "03n" ||
            iconCode == "04d" || iconCode == "04n" ||
            iconCode == "50d" || iconCode == "50n"
        ) {
            return "CLOUDY"
        } else if (iconCode == "13d" || iconCode == "13n") {
            return "SNOWY"
        } else {
            return "CLOUDY"
        }
    }

    function mapTime() {
            const hour = moment().utc().hour()

            if (hour >= 6 && hour < 21) {
                return "Morning"
            } else {
                return "Night"
            }
        }

    function mapWeatherToBackground(iconType, hour) {
        let imageUrl
        const imagePathPrefix = 'images/'
        
        if (hour === "Morning") {
            switch (iconType) {
                case "SUNNY":
                    imageUrl = imagePathPrefix + 'sunny.png' 
                    break
                case "CLOUDY":
                    imageUrl = imagePathPrefix + 'cloudy.png'
                    break
                case "RAINY":
                    imageUrl = imagePathPrefix + 'rainy.png'
                    break
                case "SNOWY":
                    imageUrl = imagePathPrefix + 'snowy.png'
                    break
                default:
                    imageUrl = imagePathPrefix + 'sunny.png'
            }
        } else {
            switch (iconType) {
                case "SUNNY": 
                    imageUrl = imagePathPrefix + 'sunny.png' 
                    break
                case "CLOUDY":
                case "RAINY":
                case "SNOWY":
                    imageUrl = imagePathPrefix + 'cloudy.png'
                    break
                default:
                    imageUrl = imagePathPrefix + 'sunny.png'
            }
        }
        return `url('${imageUrl}')`
    }    


    $.getJSON(url,function(data){
        console.log(data)

        let city = data.name
        let temp = data.main.temp.toFixed(0)
        let temp_max = data.main.temp_max.toFixed(0)
        let temp_min = data.main.temp_min.toFixed(0)
        let temp_feels = data.main.feels_like.toFixed(0)
        let iconType = mapIcon(data.weather[0].icon)

        $('#lc').text(city)
        $('#temp').html(temp + '<span class="degree-symbol">º</span>')
        $('#we').text(iconType)
        $('#fl').text('체감온도 ' + temp_feels + 'º')
        $('#temp_minmax').html('↑' + temp_max + '<span class="degree-symbol">º</span>' + '/' + '↓' + temp_min + '<span class="degree-symbol">º</span>')

        let timezoneOffset = data.timezone
        let localTime = moment().utc().add(timezoneOffset, 'seconds')
        let time = localTime.format('HH:mm')
        let date = localTime.format('MMM.DD ddd')
        $('#dt').text(date)
        $('#tm').text(time)

        let hour = mapTime(timezoneOffset); 
        let bgImage = mapWeatherToBackground(iconType, hour);
        
        $('#device').css({
            'background-image': bgImage, 
            'background-size': 'cover', 
            'background-position': 'center center', 
            'background-repeat': 'no-repeat', 
            'background-color': '#7B9BB0'
        })
    })


    let urlF = 'https://api.openweathermap.org/data/2.5/forecast?lat=60.1087&lon=-113.6426&appid=64c0242b8ce666f384557c8611204d9a&units=metric&lang=kr'

    $.getJSON(urlF,function(data){
        console.log(data)
        
        for(let i=0; i<8; i++){
        let item = data.list[i];
        let iconCode = item.weather[0].icon;
        let iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png` 

        let time = moment(item.dt * 1000).format('HH:mm')
        
        let dom = $('<div></div>')
        dom.append('<h3>' + time + '</h3>')
        dom.append('<img src="' + iconUrl + '" alt="' + item.weather[0].description + '" style="width: 50px; height: 50px;">')
        dom.append('<p>' + item.main.temp.toFixed(0) + 'º</p>')
        $('#forecast').append(dom)

        let pop = (item.pop * 100).toFixed(0);
        let rainVolume = item.rain && item.rain['3h'] ? item.rain['3h'].toFixed(1) + 'mm' : ''
        
        let rainDom = $('<div></div>')
        rainDom.append('<h3>' + time + '</h3>')

        rainDom.append('<p style="font-size: 20px; font-weight: bold; margin-bottom: 5px;">' + pop + '%</p>') 
        rainDom.append('<p style="font-size: 0.8em; font-weight: normal; margin-top: 0;">' + rainVolume + '</p>') 
        
        $('#rain_forecast').append(rainDom)
        }
    })

    $(document).ready(function() {
    const sliders = [$('#forecast')[0], $('#rain_forecast')[0]]

    sliders.forEach(slider => {
        if (!slider) return

        let isDown = false
        let startX
        let scrollLeft

        slider.addEventListener('mousedown', (e) => {
            isDown = true
            startX = e.pageX - slider.offsetLeft
            scrollLeft = slider.scrollLeft
        })

        slider.addEventListener('mouseleave', () => {
            isDown = false
        })

        slider.addEventListener('mouseup', () => {
            isDown = false
        })

        slider.addEventListener('mousemove', (e) => {
            if (!isDown) return
            e.preventDefault()
            const x = e.pageX - slider.offsetLeft
            const walk = (x - startX) * 2
            slider.scrollLeft = scrollLeft - walk
        })
    })
})

        $('.bar').on('click', function() {
            const hiddenBox = $('#hidden_box')
            
            hiddenBox.toggleClass('show')

            if (hiddenBox.hasClass('show')) {
                $('#device').animate({
                    scrollTop: 0
                }, 500)
            } else {
            }
        })

</script>
</html>